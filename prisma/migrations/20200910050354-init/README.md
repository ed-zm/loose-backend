# Migration `20200910050354-init`

This migration has been generated by Eduardo Zarraga at 9/10/2020, 1:03:54 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "loose$dev"."Task" ADD COLUMN "teamId" text   

CREATE TABLE "loose$dev"."Team" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"organizationId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "loose$dev"."_UserTeams" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_UserTeams_AB_unique" ON "loose$dev"."_UserTeams"("A", "B")

CREATE INDEX "_UserTeams_B_index" ON "loose$dev"."_UserTeams"("B")

ALTER TABLE "loose$dev"."Team" ADD FOREIGN KEY ("organizationId")REFERENCES "loose$dev"."Organization"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."_UserTeams" ADD FOREIGN KEY ("A")REFERENCES "loose$dev"."Team"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."_UserTeams" ADD FOREIGN KEY ("B")REFERENCES "loose$dev"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."Task" ADD FOREIGN KEY ("teamId")REFERENCES "loose$dev"."Team"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200910045918-init..20200910050354-init
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Comment {
   id String @default(cuid()) @id
@@ -26,8 +26,9 @@
   owner User @relation("UserOrganizations", fields: [ownerId], references: [id])
   ownerId String
   users User[] @relation("OrganizationUsers")
   tasks Task[] @relation("OrganizationTasks")
+  teams Team[] @relation(name: "OrganizationTeams")
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
@@ -44,12 +45,24 @@
   assignedToId String?
   organization Organization? @relation("OrganizationTasks", fields: [organizationId], references: [id])
   organizationId String?
   comments Comment[] @relation("TaskComments")
+  team Team? @relation("TeamTasks", fields: [teamId], references: [id])
+  teamId String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
+model Team {
+  id String @default(cuid()) @id
+  name String
+  users User[] @relation("UserTeams")
+  tasks Task[] @relation("TeamTasks")
+  organization Organization @relation("OrganizationTeams", fields: [organizationId], references: [id])
+  organizationId String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
 model User {
   id String @default(cuid()) @id
   username String @unique
@@ -67,8 +80,9 @@
   ownOrganizations Organization[] @relation("UserOrganizations")
   organizations Organization[] @relation("OrganizationUsers")
   tasksCreated Task[] @relation("TasksCreatedBy")
   tasksAssigned Task[] @relation("TasksAssignedTo")
+  teams Team[] @relation("UserTeams")
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   }
```


