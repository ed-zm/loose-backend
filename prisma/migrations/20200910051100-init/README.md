# Migration `20200910051100-init`

This migration has been generated by Eduardo Zarraga at 9/10/2020, 1:11:00 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "loose$dev"."InviteType" AS ENUM ('ORGANIZATION')

CREATE TABLE "loose$dev"."Invite" (
"id" text   NOT NULL ,
"code" text   NOT NULL ,
"fromId" text   NOT NULL ,
"toId" text   ,
"email" text   ,
"title" text   ,
"text" text   ,
"type" "InviteType"  NOT NULL ,
"typeId" text   NOT NULL ,
"expireAt" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "loose$dev"."Label" (
"id" text   NOT NULL ,
"text" text   NOT NULL ,
"color" text   NOT NULL ,
"organizationId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "loose$dev"."_TaskLabels" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "Invite.code_unique" ON "loose$dev"."Invite"("code")

CREATE UNIQUE INDEX "Label.text_unique" ON "loose$dev"."Label"("text")

CREATE UNIQUE INDEX "_TaskLabels_AB_unique" ON "loose$dev"."_TaskLabels"("A", "B")

CREATE INDEX "_TaskLabels_B_index" ON "loose$dev"."_TaskLabels"("B")

ALTER TABLE "loose$dev"."Invite" ADD FOREIGN KEY ("fromId")REFERENCES "loose$dev"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."Invite" ADD FOREIGN KEY ("toId")REFERENCES "loose$dev"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "loose$dev"."Label" ADD FOREIGN KEY ("organizationId")REFERENCES "loose$dev"."Organization"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."_TaskLabels" ADD FOREIGN KEY ("A")REFERENCES "loose$dev"."Label"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loose$dev"."_TaskLabels" ADD FOREIGN KEY ("B")REFERENCES "loose$dev"."Task"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200910050354-init..20200910051100-init
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Comment {
   id String @default(cuid()) @id
@@ -17,8 +17,40 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
+model Invite {
+  id String @default(cuid()) @id
+  code String @unique
+  from User @relation("UserSentInvites", fields: [fromId], references: [id])
+  fromId String
+  to User? @relation("UserReceivedInvites", fields: [toId], references: [id])
+  toId String?
+  email String?
+  title String?
+  text String?
+  type InviteType
+  typeId String
+  expireAt DateTime?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+enum InviteType {
+  ORGANIZATION
+}
+
+model Label {
+  id String @default(cuid()) @id
+  text String @unique
+  color String
+  organization Organization @relation("OrganizationLabels", fields: [organizationId], references: [id])
+  organizationId String
+  tasks Task[] @relation("TaskLabels")
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
 model Organization {
   id String @default(cuid()) @id
   name String
   githubToken String?
@@ -26,9 +58,10 @@
   owner User @relation("UserOrganizations", fields: [ownerId], references: [id])
   ownerId String
   users User[] @relation("OrganizationUsers")
   tasks Task[] @relation("OrganizationTasks")
-  teams Team[] @relation(name: "OrganizationTeams")
+  teams Team[] @relation("OrganizationTeams")
+  labels Label[] @relation("OrganizationLabels")
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
@@ -47,8 +80,9 @@
   organizationId String?
   comments Comment[] @relation("TaskComments")
   team Team? @relation("TeamTasks", fields: [teamId], references: [id])
   teamId String?
+  labels Label[] @relation("TaskLabels")
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
@@ -81,8 +115,10 @@
   organizations Organization[] @relation("OrganizationUsers")
   tasksCreated Task[] @relation("TasksCreatedBy")
   tasksAssigned Task[] @relation("TasksAssignedTo")
   teams Team[] @relation("UserTeams")
+  sentInvites Invite[] @relation("UserSentInvites")
+  receivedInvites Invite[] @relation("UserReceivedInvites")
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   }
```


